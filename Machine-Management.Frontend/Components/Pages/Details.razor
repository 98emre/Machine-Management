@page "/details/{id:int}"

@inject NavigationManager NavigationManager
@inject DeviceClient Client
@rendermode InteractiveServer

<PageTitle>Details</PageTitle>


@if (loading)
{
    <p><em>Loading...</em></p>
}


else
{
    <h3 class="mt-3">@title Details</h3>

    <div class="row">
        <div class="col-md-4">
            <div class="mb-3">
                <label for="name" class="form-label"><strong>Name:</strong> @device.Name</label>
            </div>

            <div class="mb-3">
                <label for="status" class="form-label"><strong>Status: </strong> @device.Status </label>
            </div>

            <div class="mb-3">
                <label for="date" class="form-label"><strong>Date: </strong> @device.Date.ToShortDateString() </label>
            </div>

           <div class="d-flex">
                <a href="@AddItemUrl(device.Id)" role="button" class="btn btn-primary me-2">Add Item </a>
                <a href="/dashboard" role="button" class="btn btn-secondary">Return back</a>
           </div>
        </div>
    </div>

    <h3 class="mt-3">Items</h3>
    <div class="row">
            @if (device.Items.Count() == 0)
            {
                <p>Empty List</p>
            }

            else
            {
                @foreach (var item in device.Items)
                {
                    <div class="col-md-4">
                        <div class="mb-3">
                            <label class="form-label">#<strong>Name:</strong> @item.Name,  <strong>Price:</strong> @item.Price</label>
                        </div>
                    </div>
                }
            }
    </div>
    }

@code {
    private bool loading = false;
    private string title = string.Empty;

    [Parameter]
    public int? Id { get; set; }

    public Device? device { get; set; }

    private static string AddItemUrl(int id) => $"/details/{id}/addItem";

    protected override void OnParametersSet()
    {
        if(device is not null)
        {
            return;
        }

        if(Id is not null)
        {
            device = Client.GetDevice(Id.Value);
            title = $"{device.Name}";
        }

        else
        {
            NavigationManager.NavigateTo("/dashboard",true);

        }
    }

}
